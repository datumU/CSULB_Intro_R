---
title: Control Structures, Functions & Packages
subtitle: CSULB Intro to R
date: April 13, 2018
#author: Chris Galbraith, Micah Jackson
output: slidy_presentation
smaller: yes
---

## Agenda
1. Control Structures
2. Functions
3. Packages
4. Helpful resources


## Control Structures:

+ A control structure is a block of programming that analyzes variables and chooses a direction in which to go based on given parameters
+ Control structures in R include:
    + **for loops**
    + **if/else statements**
    + while loops 
    + repeat
    + break 
    + next
    + return
  

## for loops:

+ Suppose we want to write "The year is [year]" where year is equal to 2014, 2015, and 2016. 
+ One way to do so is like this:

```{r echo = T}
print(paste("The year is", 2016))
print(paste("The year is", 2017))
print(paste("The year is", 2018))
```


## for loops:

+ Or, we can use a for loop: 

```{r echo = T}
for(i in 2016:2018){
  print(paste("The year is", i))
}
```

## for loops:

+ Suppose we have a numeric vector and we want to square each element
```{r echo = TRUE}
vec <- seq(2, 20, by = 2)
```
+ First, create a new vector of the same length as ```vec```
```{r echo = TRUE}
newvec <- vector("numeric", length = length(vec)) # equivalent: numeric(length(vec))
```
+ Then, write the for loop
```{r echo = TRUE}
for(i in 1:length(vec)){
  newvec[i] <- vec[i]^2
}
newvec

# advanced: vec^2
```

## if/else statements:

+ if/else statements are used to write conditional statements

```{r echo = T}
x <- 7
if (x < 10){
  print("x is less than 10")
}else{
  print("x is greater than 10")
}
```

## Combining for loops and if/else statements:
+ Suppose we have the ages of 10 individuals, and we want to categorize each age as young, middle-aged, or old
+ Using a for loop, we can iterate through each age and then use if/else statements to classify each age

## for loops and if/else statements:
```{r echo = T}
age <- sample(1:100, 10)
ageCat <- rep(NA, length(age))
for (i in 1:length(age)) {
    if (age[i] <= 35){
       ageCat[i] <- "Young"
      }else if (age[i] <= 55){
        ageCat[i] <- "Middle-Aged"
      }else{
         ageCat[i] <- "Old"
      } 
}
age.df <- data.frame(age = age, ageCat = ageCat)
age.df[1:3,]
```

<!-- need to put transition slide or something -->

## Functions
+ **What:** 
    + A chunk/block of code that encapsulates a set of instructions (including other functions!).

+ **Why:** <!-- Wording ok? -->
    + Readability: Using functions makes it easier to read your code. This allows us to more quickly debug and makes it easier to make updates to our code later.
    + Reusability: Instead of rewriting a set of instructions multiple times to complete similar tasks, you can just make a call to one function.
    + Abstraction/Generalization: Functions should allow you to easily use different inputs of varying size, amount, type, etc.
    + Automation: Functions allow you to automate a task instead of manually typing out instructions
    

## How to write functions
+ Steps to writing a function
    1. Understand the purpose of the function. What do you want it to do?
    2. Define input (parameters, arguments).
    3. Determine the algorithm and output.
    4. Define data needed inside of the function (extra variables, storage, etc).
    

<!-- need example here and prob quick hand written exercise where they write their own function. write sandwich into a function? -->


<!-- Part 7 -->
## Guided Exercise
+ What do we want our function to do?
    + Find the tallest height from a collection of heights
+ Define input.
    + "collection of heights"
    + vector of heights
    + in feet? cm? inches? miles?
    + I'm 0.00111 miles tall.
    
## Exercise Cont'd
+ Determine algorithm and output.
    + output is height of tallest person (i.e. the maximum value)

**Initialize** $tallest$ = $height_1$  
**For** each $element$ in $H$, **do**  
&nbsp;&nbsp;&nbsp;&nbsp;**If** $element > tallest$, **then**  
&nbsp;&nbsp;&nbsp;&nbsp;$tallest = element$  
end **for**  
**return** $tallest$  

```{r, evaluate=FALSE }
myHeights <- c(63, 58, 72, 65)

findTallest <- function(H){
  tallest <- H[1]
  for(height in H){
    if(height > tallest){tallest <- i}
  }
  return(tallest)
}
```

<!-- prompt them to modify the code to find the oldest person, shortest person, handle NA values -->

<!-- Parts 8,9 -->


## Packages
+ Used to share R code
+ Composed of code, data, documentation, and tests
+ Allow for easy, transparent and cross-platform extension of the R base system
+ Over 12,000 packages available on the Comprehensive R Archive Network (CRAN)
    + [Full list available packages](https://cran.r-project.org/web/packages/) 
+ For more info on how R packages are developed, please read [Creating R Packages: A Tutorial](http://cran.r-project.org/doc/contrib/Leisch-CreatingPackages.pdf) by Friedrich Leisch.


## Terminology
+ *Package*: an extension of the R base system with code, data and documentation in a standardized format
+ *Base packages*: part of the R source tree, maintained by R Core (what you downloaded before coming today)
+ *Repository*: a website that hosts a package for installation
+ *Source*: the original version of a package with human-readable text and code
+ *Library*: a directory containing installed packages (this is on your machine)


## Installing Packages
There are two main ways to install a package in R:

1. Installing from CRAN: install a package directly from the repository
    + Using R studio: ```Tools > Install Packages...```
    + From R console: ```install.packages("package name")```
2. Installing from source: first download the add-on R package and then type the following in your console:
    + ```install.packages("path_to_file", repos = NULL, type = "source")``` 
3. Installing a variety of sources using the ```devtools``` package (must have it installed first!)
    + Github:  ```devtools::install_github("repo name")```
    + URL:  ```devtools::install_url("url")```
    + Other methods available, too
    

## Using Packages
There are two ways to access code and data from an installed package:

1. Loading the package to the current R workspace with the ```library()``` function
    + ```library(package)``` loads all contents of ```package``` and makes them accessible until R restarts
    + This is the recommended way to use packages

2. Directly referencing the code/data with the ```::``` operator
    + Instead of loading an entire package, we can instead temporarily access its contents 
    + ```package::name``` accesses ```name``` from ```package``` for a one-time use
    + Useful when you only need to use a single object once or twice 


## Install some packages from CRAN
Let's install ```devtools, here, and car``` from CRAN using the console:
```{r echo=TRUE, eval=FALSE}
install.packages("devtools", dependencies = TRUE)
install.packages("here", dependencies = TRUE)
install.packages("car", dependencies = TRUE)
```


## Using a Package
Now, let's use ```devtools``` to install ```BRRR``` from Github (more info [here](https://github.com/brooke-watson/BRRR)). 

Method 1:
```{r echo=TRUE, eval=FALSE}
library(devtools)  # load the devtools package
install_github("brooke-watson/BRRR")  # use the function install_github() to install BRRR
```

Method 2: 
```{r echo=TRUE, eval=FALSE}
devtools::install_github("brooke-watson/BRRR")  # use the function install_github() from devtools to install BRRR
```

Play around with BRRR!


## Popular Packages
+ To visualize data:
    + ```ggplot2```: to create beautiful graphics
    + ```googleVis```: to use Google Chart tools
+ To report results:
    + ```shiny```: to create interactive web-based apps
    + ```knitr```: to combine R codes and Latex/Markdown codes
    + ```slidify```: to build HTML 5 slide shows
+ To write high-performance R code:
    + ```rcpp```: to write R functions that call C++ code
    + ```data.table```: to organize datasets for fast operations
    + ```parallel```: to use parallel processing in R


## Helpful Resources
+ General programming (Khan academy, etc)
+ R (CRAN, Rbloggers, RStudio cheat sheets, Stackoverflow, Books - Data Science with R, etc)


## How to Troubleshoot/De-bug
+ built in Help in R
+ stackoverflow





